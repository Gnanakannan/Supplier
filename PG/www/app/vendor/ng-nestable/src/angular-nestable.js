(function(window,document,angular,undefined){angular.module("ng-nestable",[]).provider("$nestable",function(){var modelName="$item";var defaultOptions={};this.$get=function(){return{modelName:modelName,defaultOptions:defaultOptions}};this.modelName=function(value){modelName=value};this.defaultOptions=function(value){defaultOptions=value}}).directive("ngNestable",["$compile","$nestable",function($compile,$nestable){return{restrict:"A",require:"ngModel",compile:function(element){var itemTemplate=element.html();element.empty();return function($scope,$element,$attrs,$ngModel){var options=$.extend({},$nestable.defaultOptions,$scope.$eval($attrs.ngNestable));$scope.$watchCollection(function(){return $ngModel.$modelValue},function(model){if(model){model=runFormatters(model,$ngModel);var root=buildNestableHtml(model,itemTemplate);$element.empty().append(root);$compile(root)($scope);root.nestable(options);root.on("change",function(){$ngModel.$setViewValue(root.nestable("serialize"));$scope&&$scope.$root&&$scope.$root.$$phase||$scope.$apply()})}})}},controller:angular.noop};function buildNestableHtml(model,tpl){var root=$('<div class="dd"></div>');var rootList=$('<ol class="dd-list"></ol>').appendTo(root);model.forEach(function f(item){var list=Array.prototype.slice.call(arguments).slice(-1)[0];if(!(list instanceof $))list=rootList;var listItem=$('<li class="dd-item"></li>');var listElement=$('<div ng-nestable-item class="dd-handle"></div>');listElement.append(tpl).appendTo(listItem);list.append(listItem);listItem.data("item",item.item);if(isArray(item.children)&&item.children.length>0){var subRoot=$('<ol class="dd-list"></ol>').appendTo(listItem);item.children.forEach(function(item){f.apply(this,Array.prototype.slice.call(arguments).concat([subRoot]))})}});return root}function isArray(arr){return Object.prototype.toString.call(arr)==="[object Array]"}function runFormatters(value,ctrl){var formatters=ctrl.$formatters,idx=formatters.length;ctrl.$modelValue=value;while(idx--){value=formatters[idx](value)}return value}}]).directive("ngNestableItem",["$nestable",function($nestable){return{scope:true,require:"^ngNestable",link:function($scope,$element){$scope[$nestable.modelName]=$element.parent().data("item")}}}])})(window,document,window.angular);