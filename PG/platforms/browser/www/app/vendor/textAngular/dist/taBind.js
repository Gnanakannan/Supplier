angular.module("textAngular.taBind",["textAngular.factories","textAngular.DOM"]).service("_taBlankTest",[function(){var INLINETAGS_NONBLANK=/<(a|abbr|acronym|bdi|bdo|big|cite|code|del|dfn|img|ins|kbd|label|map|mark|q|ruby|rp|rt|s|samp|time|tt|var)[^>]*(>|$)/i;return function(_defaultTest){return function(_blankVal){if(!_blankVal)return true;var _firstMatch=/(^[^<]|>)[^<]/i.exec(_blankVal);var _firstTagIndex;if(!_firstMatch){_blankVal=_blankVal.toString().replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"");_firstTagIndex=_blankVal.indexOf(">")}else{_firstTagIndex=_firstMatch.index}_blankVal=_blankVal.trim().substring(_firstTagIndex,_firstTagIndex+100);if(/^[^<>]+$/i.test(_blankVal))return false;if(_blankVal.length===0||_blankVal===_defaultTest||/^>(\s|&nbsp;)*<\/[^>]+>$/gi.test(_blankVal))return true;else if(/>\s*[^\s<]/i.test(_blankVal)||INLINETAGS_NONBLANK.test(_blankVal))return false;else return true}}}]).directive("taButton",[function(){return{link:function(scope,element,attrs){element.attr("unselectable","on");element.on("mousedown",function(e,eventData){if(eventData)angular.extend(e,eventData);e.preventDefault();return false})}}}]).directive("taBind",["taSanitize","$timeout","$window","$document","taFixChrome","taBrowserTag","taSelection","taSelectableElements","taApplyCustomRenderers","taOptions","_taBlankTest","$parse","taDOM",function(taSanitize,$timeout,$window,$document,taFixChrome,taBrowserTag,taSelection,taSelectableElements,taApplyCustomRenderers,taOptions,_taBlankTest,$parse,taDOM){return{priority:2,require:["ngModel","?ngModelOptions"],link:function(scope,element,attrs,controller){var ngModel=controller[0];var ngModelOptions=controller[1]||{};var _isContentEditable=element.attr("contenteditable")!==undefined&&element.attr("contenteditable");var _isInputFriendly=_isContentEditable||element[0].tagName.toLowerCase()==="textarea"||element[0].tagName.toLowerCase()==="input";var _isReadonly=false;var _focussed=false;var _skipRender=false;var _disableSanitizer=attrs.taUnsafeSanitizer||taOptions.disableSanitizer;var _lastKey;var BLOCKED_KEYS=/^(9|19|20|27|33|34|35|36|37|38|39|40|45|112|113|114|115|116|117|118|119|120|121|122|123|144|145)$/i;var UNDO_TRIGGER_KEYS=/^(8|13|32|46|59|61|107|109|186|187|188|189|190|191|192|219|220|221|222)$/i;var _pasteHandler;var _defaultVal,_defaultTest;if(attrs.taDefaultWrap===undefined)attrs.taDefaultWrap="p";if(attrs.taDefaultWrap===""){_defaultVal="";_defaultTest=_browserDetect.ie===undefined?"<div><br></div>":_browserDetect.ie>=11?"<p><br></p>":_browserDetect.ie<=8?"<P>&nbsp;</P>":"<p>&nbsp;</p>"}else{_defaultVal=_browserDetect.ie===undefined||_browserDetect.ie>=11?"<"+attrs.taDefaultWrap+"><br></"+attrs.taDefaultWrap+">":_browserDetect.ie<=8?"<"+attrs.taDefaultWrap.toUpperCase()+"></"+attrs.taDefaultWrap.toUpperCase()+">":"<"+attrs.taDefaultWrap+"></"+attrs.taDefaultWrap+">";_defaultTest=_browserDetect.ie===undefined||_browserDetect.ie>=11?"<"+attrs.taDefaultWrap+"><br></"+attrs.taDefaultWrap+">":_browserDetect.ie<=8?"<"+attrs.taDefaultWrap.toUpperCase()+">&nbsp;</"+attrs.taDefaultWrap.toUpperCase()+">":"<"+attrs.taDefaultWrap+">&nbsp;</"+attrs.taDefaultWrap+">"}if(!ngModelOptions.$options)ngModelOptions.$options={};var _blankTest=_taBlankTest(_defaultTest);var _ensureContentWrapped=function(value){if(_blankTest(value))return value;var domTest=angular.element("<div>"+value+"</div>");if(domTest.children().length===0){value="<"+attrs.taDefaultWrap+">"+value+"</"+attrs.taDefaultWrap+">"}else{var _children=domTest[0].childNodes;var i;var _foundBlockElement=false;for(i=0;i<_children.length;i++){if(_foundBlockElement=_children[i].nodeName.toLowerCase().match(BLOCKELEMENTS))break}if(!_foundBlockElement){value="<"+attrs.taDefaultWrap+">"+value+"</"+attrs.taDefaultWrap+">"}else{value="";for(i=0;i<_children.length;i++){if(!_children[i].nodeName.toLowerCase().match(BLOCKELEMENTS)){var _subVal=_children[i].outerHTML||_children[i].nodeValue;if(_subVal.trim()!=="")value+="<"+attrs.taDefaultWrap+">"+_subVal+"</"+attrs.taDefaultWrap+">";else value+=_subVal}else{value+=_children[i].outerHTML}}}}return value};if(attrs.taPaste)_pasteHandler=$parse(attrs.taPaste);element.addClass("ta-bind");var _undoKeyupTimeout;scope["$undoManager"+(attrs.id||"")]=ngModel.$undoManager={_stack:[],_index:0,_max:1e3,push:function(value){if(typeof value==="undefined"||value===null||typeof this.current()!=="undefined"&&this.current()!==null&&value===this.current())return value;if(this._index<this._stack.length-1){this._stack=this._stack.slice(0,this._index+1)}this._stack.push(value);if(_undoKeyupTimeout)$timeout.cancel(_undoKeyupTimeout);if(this._stack.length>this._max)this._stack.shift();this._index=this._stack.length-1;return value},undo:function(){return this.setToIndex(this._index-1)},redo:function(){return this.setToIndex(this._index+1)},setToIndex:function(index){if(index<0||index>this._stack.length-1){return undefined}this._index=index;return this.current()},current:function(){return this._stack[this._index]}};var _redoUndoTimeout;var _undo=scope["$undoTaBind"+(attrs.id||"")]=function(){if(!_isReadonly&&_isContentEditable){var content=ngModel.$undoManager.undo();if(typeof content!=="undefined"&&content!==null){_setInnerHTML(content);_setViewValue(content,false);if(_redoUndoTimeout)$timeout.cancel(_redoUndoTimeout);_redoUndoTimeout=$timeout(function(){element[0].focus();taSelection.setSelectionToElementEnd(element[0])},1)}}};var _redo=scope["$redoTaBind"+(attrs.id||"")]=function(){if(!_isReadonly&&_isContentEditable){var content=ngModel.$undoManager.redo();if(typeof content!=="undefined"&&content!==null){_setInnerHTML(content);_setViewValue(content,false);if(_redoUndoTimeout)$timeout.cancel(_redoUndoTimeout);_redoUndoTimeout=$timeout(function(){element[0].focus();taSelection.setSelectionToElementEnd(element[0])},1)}}};var _compileHtml=function(){if(_isContentEditable)return element[0].innerHTML;if(_isInputFriendly)return element.val();throw"textAngular Error: attempting to update non-editable taBind"};var _setViewValue=function(_val,triggerUndo,skipRender){_skipRender=skipRender||false;if(typeof triggerUndo==="undefined"||triggerUndo===null)triggerUndo=true&&_isContentEditable;if(typeof _val==="undefined"||_val===null)_val=_compileHtml();if(_blankTest(_val)){if(ngModel.$viewValue!=="")ngModel.$setViewValue("");if(triggerUndo&&ngModel.$undoManager.current()!=="")ngModel.$undoManager.push("")}else{_reApplyOnSelectorHandlers();if(ngModel.$viewValue!==_val){ngModel.$setViewValue(_val);if(triggerUndo)ngModel.$undoManager.push(_val)}}ngModel.$render()};scope["updateTaBind"+(attrs.id||"")]=function(){if(!_isReadonly)_setViewValue(undefined,undefined,true)};var _sanitize=function(unsafe){return ngModel.$oldViewValue=taSanitize(taFixChrome(unsafe),ngModel.$oldViewValue,_disableSanitizer)};if(element.attr("required"))ngModel.$validators.required=function(modelValue,viewValue){return!_blankTest(modelValue||viewValue)};ngModel.$parsers.push(_sanitize);ngModel.$parsers.unshift(_ensureContentWrapped);ngModel.$formatters.push(_sanitize);ngModel.$formatters.unshift(_ensureContentWrapped);ngModel.$formatters.unshift(function(value){return ngModel.$undoManager.push(value||"")});if(_isInputFriendly){scope.events={};if(!_isContentEditable){element.on("change blur",scope.events.change=scope.events.blur=function(){if(!_isReadonly)ngModel.$setViewValue(_compileHtml())});element.on("keydown",scope.events.keydown=function(event,eventData){if(eventData)angular.extend(event,eventData);if(event.keyCode===9){var start=this.selectionStart;var end=this.selectionEnd;var value=element.val();if(event.shiftKey){var _linebreak=value.lastIndexOf("\n",start),_tab=value.lastIndexOf("\t",start);if(_tab!==-1&&_tab>=_linebreak){element.val(value.substring(0,_tab)+value.substring(_tab+1));this.selectionStart=this.selectionEnd=start-1}}else{element.val(value.substring(0,start)+"\t"+value.substring(end));this.selectionStart=this.selectionEnd=start+1}event.preventDefault()}});var _repeat=function(string,n){var result="";for(var _n=0;_n<n;_n++)result+=string;return result};var recursiveListFormat=function(listNode,tablevel){var _html="",_children=listNode.childNodes;tablevel++;_html+=_repeat("\t",tablevel-1)+listNode.outerHTML.substring(0,listNode.outerHTML.indexOf("<li"));for(var _i=0;_i<_children.length;_i++){if(!_children[_i].outerHTML)continue;if(_children[_i].nodeName.toLowerCase()==="ul"||_children[_i].nodeName.toLowerCase()==="ol")_html+="\n"+recursiveListFormat(_children[_i],tablevel);else _html+="\n"+_repeat("\t",tablevel)+_children[_i].outerHTML}_html+="\n"+_repeat("\t",tablevel-1)+listNode.outerHTML.substring(listNode.outerHTML.lastIndexOf("<"));return _html};ngModel.$formatters.unshift(function(htmlValue){var _children=angular.element("<div>"+htmlValue+"</div>")[0].childNodes;if(_children.length>0){htmlValue="";for(var i=0;i<_children.length;i++){if(!_children[i].outerHTML)continue;if(htmlValue.length>0)htmlValue+="\n";if(_children[i].nodeName.toLowerCase()==="ul"||_children[i].nodeName.toLowerCase()==="ol")htmlValue+=""+recursiveListFormat(_children[i],0);else htmlValue+=""+_children[i].outerHTML}}return htmlValue})}else{var _processingPaste=false;var processpaste=function(text){if(text&&text.trim().length){if(text.match(/class=["']*Mso(Normal|List)/i)){var textFragment=text.match(/<!--StartFragment-->([\s\S]*?)<!--EndFragment-->/i);if(!textFragment)textFragment=text;else textFragment=textFragment[1];textFragment=textFragment.replace(/<o:p>[\s\S]*?<\/o:p>/gi,"").replace(/class=(["']|)MsoNormal(["']|)/gi,"");var dom=angular.element("<div>"+textFragment+"</div>");var targetDom=angular.element("<div></div>");var _list={element:null,lastIndent:[],lastLi:null,isUl:false};_list.lastIndent.peek=function(){var n=this.length;if(n>0)return this[n-1]};var _resetList=function(isUl){_list.isUl=isUl;_list.element=angular.element(isUl?"<ul>":"<ol>");_list.lastIndent=[];_list.lastIndent.peek=function(){var n=this.length;if(n>0)return this[n-1]};_list.lastLevelMatch=null};for(var i=0;i<=dom[0].childNodes.length;i++){if(!dom[0].childNodes[i]||dom[0].childNodes[i].nodeName==="#text"||dom[0].childNodes[i].tagName.toLowerCase()!=="p")continue;var el=angular.element(dom[0].childNodes[i]);var _listMatch=(el.attr("class")||"").match(/MsoList(Bullet|Number|Paragraph)(CxSp(First|Middle|Last)|)/i);if(_listMatch){if(el[0].childNodes.length<2||el[0].childNodes[1].childNodes.length<1){continue}var isUl=_listMatch[1].toLowerCase()==="bullet"||_listMatch[1].toLowerCase()!=="number"&&!(/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(el[0].childNodes[1].innerHTML)||/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(el[0].childNodes[1].childNodes[0].innerHTML));var _indentMatch=(el.attr("style")||"").match(/margin-left:([\-\.0-9]*)/i);var indent=parseFloat(_indentMatch?_indentMatch[1]:0);var _levelMatch=(el.attr("style")||"").match(/mso-list:l([0-9]+) level([0-9]+) lfo[0-9+]($|;)/i);if(_levelMatch&&_levelMatch[2])indent=parseInt(_levelMatch[2]);if(_levelMatch&&(!_list.lastLevelMatch||_levelMatch[1]!==_list.lastLevelMatch[1])||!_listMatch[3]||_listMatch[3].toLowerCase()==="first"||_list.lastIndent.peek()===null||_list.isUl!==isUl&&_list.lastIndent.peek()===indent){_resetList(isUl);targetDom.append(_list.element)}else if(_list.lastIndent.peek()!=null&&_list.lastIndent.peek()<indent){_list.element=angular.element(isUl?"<ul>":"<ol>");_list.lastLi.append(_list.element)}else if(_list.lastIndent.peek()!=null&&_list.lastIndent.peek()>indent){while(_list.lastIndent.peek()!=null&&_list.lastIndent.peek()>indent){if(_list.element.parent()[0].tagName.toLowerCase()==="li"){_list.element=_list.element.parent();continue}else if(/[uo]l/i.test(_list.element.parent()[0].tagName.toLowerCase())){_list.element=_list.element.parent()}else{break}_list.lastIndent.pop()}_list.isUl=_list.element[0].tagName.toLowerCase()==="ul";if(isUl!==_list.isUl){_resetList(isUl);targetDom.append(_list.element)}}_list.lastLevelMatch=_levelMatch;if(indent!==_list.lastIndent.peek())_list.lastIndent.push(indent);_list.lastLi=angular.element("<li>");_list.element.append(_list.lastLi);_list.lastLi.html(el.html().replace(/<!(--|)\[if !supportLists\](--|)>[\s\S]*?<!(--|)\[endif\](--|)>/gi,""));el.remove()}else{_resetList(false);targetDom.append(el)}}var _unwrapElement=function(node){node=angular.element(node);for(var _n=node[0].childNodes.length-1;_n>=0;_n--)node.after(node[0].childNodes[_n]);node.remove()};angular.forEach(targetDom.find("span"),function(node){node.removeAttribute("lang");if(node.attributes.length<=0)_unwrapElement(node)});angular.forEach(targetDom.find("font"),_unwrapElement);text=targetDom.html()}else{text=text.replace(/<(|\/)meta[^>]*?>/gi,"");if(text.match(/<[^>]*?(ta-bind)[^>]*?>/)){if(text.match(/<[^>]*?(text-angular)[^>]*?>/)){var _el=angular.element("<div>"+text+"</div>");_el.find("textarea").remove();var binds=taDOM.getByAttribute(_el,"ta-bind");for(var _b=0;_b<binds.length;_b++){var _target=binds[_b][0].parentNode.parentNode;for(var _c=0;_c<binds[_b][0].childNodes.length;_c++){_target.parentNode.insertBefore(binds[_b][0].childNodes[_c],_target)}_target.parentNode.removeChild(_target)}text=_el.html().replace('<br class="Apple-interchange-newline">',"")}}else if(text.match(/^<span/)){text=text.replace(/<(|\/)span[^>]*?>/gi,"")}text=text.replace(/<br class="Apple-interchange-newline"[^>]*?>/gi,"").replace(/<span class="Apple-converted-space">( |&nbsp;)<\/span>/gi,"&nbsp;")}if(/<li(\s.*)?>/i.test(text)&&/(<ul(\s.*)?>|<ol(\s.*)?>).*<li(\s.*)?>/i.test(text)===false){text=text.replace(/<li(\s.*)?>.*<\/li(\s.*)?>/i,"<ul>$&</ul>")}if(_pasteHandler)text=_pasteHandler(scope,{$html:text})||text;text=taSanitize(text,"",_disableSanitizer);taSelection.insertHtml(text,element[0]);$timeout(function(){ngModel.$setViewValue(_compileHtml());_processingPaste=false;element.removeClass("processing-paste")},0)}else{_processingPaste=false;element.removeClass("processing-paste")}};element.on("paste",scope.events.paste=function(e,eventData){if(eventData)angular.extend(e,eventData);if(_isReadonly||_processingPaste){e.stopPropagation();e.preventDefault();return false}_processingPaste=true;element.addClass("processing-paste");var pastedContent;var clipboardData=(e.originalEvent||e).clipboardData;if(clipboardData&&clipboardData.getData&&clipboardData.types.length>0){var _types="";for(var _t=0;_t<clipboardData.types.length;_t++){_types+=" "+clipboardData.types[_t]}if(/text\/html/i.test(_types)){pastedContent=clipboardData.getData("text/html")}else if(/text\/plain/i.test(_types)){pastedContent=clipboardData.getData("text/plain")}processpaste(pastedContent);e.stopPropagation();e.preventDefault();return false}else{var _savedSelection=$window.rangy.saveSelection(),_tempDiv=angular.element('<div class="ta-hidden-input" contenteditable="true"></div>');$document.find("body").append(_tempDiv);_tempDiv[0].focus();$timeout(function(){$window.rangy.restoreSelection(_savedSelection);processpaste(_tempDiv[0].innerHTML);element[0].focus();_tempDiv.remove()},0)}});element.on("cut",scope.events.cut=function(e){if(!_isReadonly)$timeout(function(){ngModel.$setViewValue(_compileHtml())},0);else e.preventDefault()});element.on("keydown",scope.events.keydown=function(event,eventData){if(eventData)angular.extend(event,eventData);if(!_isReadonly){if(!event.altKey&&(event.metaKey||event.ctrlKey)){if(event.keyCode===90&&!event.shiftKey){_undo();event.preventDefault()}else if(event.keyCode===90&&event.shiftKey||event.keyCode===89&&!event.shiftKey){_redo();event.preventDefault()}}else if(event.keyCode===13&&!event.shiftKey){var $selection;var selection=taSelection.getSelectionElement();if(!selection.tagName.match(VALIDELEMENTS))return;var _new=angular.element(_defaultVal);if(/^<br(|\/)>$/i.test(selection.innerHTML.trim())&&selection.parentNode.tagName.toLowerCase()==="blockquote"&&!selection.nextSibling){$selection=angular.element(selection);var _parent=$selection.parent();_parent.after(_new);$selection.remove();if(_parent.children().length===0)_parent.remove();taSelection.setSelectionToElementStart(_new[0]);event.preventDefault()}else if(/^<[^>]+><br(|\/)><\/[^>]+>$/i.test(selection.innerHTML.trim())&&selection.tagName.toLowerCase()==="blockquote"){$selection=angular.element(selection);$selection.after(_new);$selection.remove();taSelection.setSelectionToElementStart(_new[0]);event.preventDefault()}}}});var _keyupTimeout;element.on("keyup",scope.events.keyup=function(event,eventData){if(eventData)angular.extend(event,eventData);if(event.keyCode===9){var _selection=taSelection.getSelection();if(_selection.start.element===element[0]&&element.children().length)taSelection.setSelectionToElementStart(element.children()[0]);return}if(_undoKeyupTimeout)$timeout.cancel(_undoKeyupTimeout);if(!_isReadonly&&!BLOCKED_KEYS.test(event.keyCode)){if(_defaultVal!==""&&event.keyCode===13){if(!event.shiftKey){var selection=taSelection.getSelectionElement();while(!selection.tagName.match(VALIDELEMENTS)&&selection!==element[0]){selection=selection.parentNode}if(selection.tagName.toLowerCase()!==attrs.taDefaultWrap&&selection.tagName.toLowerCase()!=="li"&&(selection.innerHTML.trim()===""||selection.innerHTML.trim()==="<br>")){var _new=angular.element(_defaultVal);angular.element(selection).replaceWith(_new);taSelection.setSelectionToElementStart(_new[0])}}}var val=_compileHtml();if(_defaultVal!==""&&val.trim()===""){_setInnerHTML(_defaultVal);taSelection.setSelectionToElementStart(element.children()[0])}else if(val.substring(0,1)!=="<"&&attrs.taDefaultWrap!==""){var _savedSelection=$window.rangy.saveSelection();val=_compileHtml();val="<"+attrs.taDefaultWrap+">"+val+"</"+attrs.taDefaultWrap+">";_setInnerHTML(val);$window.rangy.restoreSelection(_savedSelection)}var triggerUndo=_lastKey!==event.keyCode&&UNDO_TRIGGER_KEYS.test(event.keyCode);if(_keyupTimeout)$timeout.cancel(_keyupTimeout);_keyupTimeout=$timeout(function(){_setViewValue(val,triggerUndo,true)},ngModelOptions.$options.debounce||400);if(!triggerUndo)_undoKeyupTimeout=$timeout(function(){ngModel.$undoManager.push(val)},250);_lastKey=event.keyCode}});element.on("blur",scope.events.blur=function(){_focussed=false;if(!_isReadonly){_setViewValue(undefined,undefined,true)}else{_skipRender=true;ngModel.$render()}});if(attrs.placeholder&&(_browserDetect.ie>8||_browserDetect.ie===undefined)){var rule;if(attrs.id)rule=addCSSRule("#"+attrs.id+".placeholder-text:before",'content: "'+attrs.placeholder+'"');else throw"textAngular Error: An unique ID is required for placeholders to work";scope.$on("$destroy",function(){removeCSSRule(rule)})}element.on("focus",scope.events.focus=function(){_focussed=true;element.removeClass("placeholder-text")});element.on("mouseup",scope.events.mouseup=function(){var _selection=taSelection.getSelection();if(_selection.start.element===element[0]&&element.children().length)taSelection.setSelectionToElementStart(element.children()[0])});element.on("mousedown",scope.events.mousedown=function(event,eventData){if(eventData)angular.extend(event,eventData);event.stopPropagation()})}}var selectorClickHandler=function(event){scope.$emit("ta-element-select",this);event.preventDefault();return false};var fileDropHandler=function(event,eventData){if(eventData)angular.extend(event,eventData);if(!dropFired&&!_isReadonly){dropFired=true;var dataTransfer;if(event.originalEvent)dataTransfer=event.originalEvent.dataTransfer;else dataTransfer=event.dataTransfer;scope.$emit("ta-drop-event",this,event,dataTransfer);$timeout(function(){dropFired=false;_setViewValue(undefined,undefined,true)},100)}};var _reApplyOnSelectorHandlers=scope["reApplyOnSelectorHandlers"+(attrs.id||"")]=function(){if(!_isReadonly)angular.forEach(taSelectableElements,function(selector){element.find(selector).off("click",selectorClickHandler).on("click",selectorClickHandler)})};var _setInnerHTML=function(newval){element[0].innerHTML=newval};var _renderTimeout;var _renderInProgress=false;ngModel.$render=function(){if(_renderInProgress)return;else _renderInProgress=true;var val=ngModel.$viewValue||"";if(!_skipRender){if(_isContentEditable&&_focussed){element.removeClass("placeholder-text");if(_renderTimeout)$timeout.cancel(_renderTimeout);_renderTimeout=$timeout(function(){if(!_focussed){element[0].focus();taSelection.setSelectionToElementEnd(element.children()[element.children().length-1])}_renderTimeout=undefined},1)}if(_isContentEditable){if(attrs.placeholder){if(val===""){_setInnerHTML(_defaultVal)}else{_setInnerHTML(val)}}else{_setInnerHTML(val===""?_defaultVal:val)}if(!_isReadonly){_reApplyOnSelectorHandlers();element.on("drop",fileDropHandler)}else{element.off("drop",fileDropHandler)}}else if(element[0].tagName.toLowerCase()!=="textarea"&&element[0].tagName.toLowerCase()!=="input"){_setInnerHTML(taApplyCustomRenderers(val))}else{element.val(val)}}if(_isContentEditable&&attrs.placeholder){if(val===""){if(_focussed)element.removeClass("placeholder-text");else element.addClass("placeholder-text")}else{element.removeClass("placeholder-text")}}_renderInProgress=_skipRender=false};if(attrs.taReadonly){_isReadonly=scope.$eval(attrs.taReadonly);if(_isReadonly){element.addClass("ta-readonly");if(element[0].tagName.toLowerCase()==="textarea"||element[0].tagName.toLowerCase()==="input"){element.attr("disabled","disabled")}if(element.attr("contenteditable")!==undefined&&element.attr("contenteditable")){element.removeAttr("contenteditable")}}else{element.removeClass("ta-readonly");if(element[0].tagName.toLowerCase()==="textarea"||element[0].tagName.toLowerCase()==="input"){element.removeAttr("disabled")}else if(_isContentEditable){element.attr("contenteditable","true")}}scope.$watch(attrs.taReadonly,function(newVal,oldVal){if(oldVal===newVal)return;if(newVal){element.addClass("ta-readonly");if(element[0].tagName.toLowerCase()==="textarea"||element[0].tagName.toLowerCase()==="input"){element.attr("disabled","disabled")}if(element.attr("contenteditable")!==undefined&&element.attr("contenteditable")){element.removeAttr("contenteditable")}angular.forEach(taSelectableElements,function(selector){element.find(selector).on("click",selectorClickHandler)});element.off("drop",fileDropHandler)}else{element.removeClass("ta-readonly");if(element[0].tagName.toLowerCase()==="textarea"||element[0].tagName.toLowerCase()==="input"){element.removeAttr("disabled")}else if(_isContentEditable){element.attr("contenteditable","true")}angular.forEach(taSelectableElements,function(selector){element.find(selector).off("click",selectorClickHandler)});element.on("drop",fileDropHandler)}_isReadonly=newVal})}if(_isContentEditable&&!_isReadonly){angular.forEach(taSelectableElements,function(selector){element.find(selector).on("click",selectorClickHandler)});element.on("drop",fileDropHandler);element.on("blur",function(){if(_browserDetect.webkit){globalContentEditableBlur=true}})}}}}]);